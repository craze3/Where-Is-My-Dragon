"use strict";function _typeof(e){return e&&typeof Symbol!="undefined"&&e.constructor===Symbol?"symbol":typeof e}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(i,s){try{var o=t[i](s),u=o.value}catch(a){n(a);return}if(!o.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}return r("next")})}}!window.preloadedScripts && (window.preloadedScripts=[]);Array.prototype.push.apply(window.preloadedScripts,['spa/farming/controller.jsx','spa/farming/style.min.css','spa/farming/view.jsx','spa/index/cardCraftSelector.jsx','spa/index/cardInfo.jsx','spa/index/controller.jsx','spa/index/style.min.css','spa/index/view.jsx','spa/inlineLoader.jsx']);var FarmingController=function(t){var n=this;n.view=t,n.loadData=function(){function t(){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n.loadItems(),n.loadStakingData();case 2:case"end":return t.stop()}},r,this)}));return t}(),n.loadItems=function(){function t(){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function r(){var e,t,i,s;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:e=[],t=0;case 2:if(!(t<n.view.props.sortedItems.length)){o.next=12;break}return i=n.view.props.sortedItems[t],s={item:i},o.next=7,window.getTokenPriceInDollarsOnUniswap(i.erc20Wrapper,18);case 7:s.priceInDollars=o.sent,e.push(s);case 9:t++,o.next=2;break;case 12:n.view.setState({items:e});case 13:case"end":return o.stop()}},r,this)}));return t}(),n.loadStakingData=function(){function t(){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function r(){var e,t,i,s,o,u,a,f,l,c,h,p,d;return regeneratorRuntime.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,window.AJAXRequest("data/stakingContracts.json");case 2:e=v.sent,t=Object.values(e),i=t,s=Array.isArray(i),o=0,i=s?i:i[Symbol.iterator]();case 5:if(!s){v.next=11;break}if(!(o>=i.length)){v.next=8;break}return v.abrupt("break",36);case 8:u=i[o++],v.next=15;break;case 11:o=i.next();if(!o.done){v.next=14;break}return v.abrupt("break",36);case 14:u=o.value;case 15:a=u,f=Object.values(a),l=f,c=Array.isArray(l),h=0,l=c?l:l[Symbol.iterator]();case 18:if(!c){v.next=24;break}if(!(h>=l.length)){v.next=21;break}return v.abrupt("break",34);case 21:p=l[h++],v.next=28;break;case 24:h=l.next();if(!h.done){v.next=27;break}return v.abrupt("break",34);case 27:p=h.value;case 28:return d=p,v.next=31,window.loadStakingData(d.stakingAddresses);case 31:d.stakingData=v.sent;case 32:v.next=18;break;case 34:v.next=5;break;case 36:n.view.setState({stakingContracts:e});case 37:case"end":return v.stop()}},r,this)}));return t}()};var Farming=React.createClass({displayName:"Farming",requiredScripts:["spa/index/cardInfo.jsx","spa/inlineLoader.jsx"],componentDidMount:function(){this.controller.loadData()},getFirstEndBlock:function(t){var n=Object.values(t);for(var r=n,i=Array.isArray(r),s=0,r=i?r:r[Symbol.iterator]();;){var o;if(i){if(s>=r.length)break;o=r[s++]}else{s=r.next();if(s.done)break;o=s.value}var u=o;if(u.stakingData&&u.stakingData.stakingData&&u.stakingData.stakingData.length>0)return u.stakingData.stakingData[0].endBlock}},render:function(){var t=this,n=this;return React.createElement("section",null,React.createElement("section",{className:"FarmingTop"},React.createElement("h2",{className:"BrandizedS"},"Cards"),this.props.sortedItems.map(function(e,n){return React.createElement("section",{key:e.key,className:"collection"},React.createElement(CardInfo,{card:e,clean:!0,hideBalance:!0}),t.state&&t.state.items&&t.state.items[n]&&React.createElement("span",{className:"UniPriceBro"},"$ ",window.formatMoney(t.state.items[n].priceInDollars,1)),React.createElement("br",null),React.createElement("a",{className:"unibtn",href:window.context.uniswapSpawUrlTemplate.format(e.erc20Wrapper),target:"_blank"},"ðŸ¦„swap"))}),React.createElement("section",{className:"Delimitator"}),(!this.state||!this.state.stakingContracts)&&React.createElement(InlineLoader,null),this.state&&this.state.stakingContracts&&Object.entries(this.state.stakingContracts).map(function(e){var t=e[0],r=e[1],i=n.getFirstEndBlock(r);return React.createElement("section",{key:t,className:"FarmingSeason"},React.createElement("h2",{className:"BrandizedS"},t," ",React.createElement("a",{target:"_blank",href:window.getNetworkElement("etherscanURL")+"block/"+i},"(Ending block n. ",i,")")),Object.entries(r).filter(function(e){return e[1].stakingData&&e[1].stakingData.stakingData&&e[1].stakingData.stakingData.length>0}).map(function(e){var t=e[0],n=e[1],r=n.stakingData.stakingData;return r.map(function(e){var n=100/e.tiers[0].percentage;return React.createElement("section",{key:t,className:"FarmingTier"},React.createElement("img",{src:window.formatLink(e.rewardToken.logo||e.rewardToken.logoURI)}),React.createElement("p",null,"Earn 1 ",e.rewardToken.name," Card for every:"),React.createElement("a",{className:"GoToFarm",target:"_blank",href:window.context.stakingUrlTemplate.format(e.stakingManager.options.address)},"FARM"),React.createElement("br",null),React.createElement("section",{className:"FarmingTierDeal"},React.createElement("img",{src:window.formatLink(e.mainToken.logo||e.mainToken.logoURI)}),React.createElement("p",null,window.formatMoney(n,2)," ",e.mainToken.symbol," locked in the Uniswap V2 pair ",e.mainToken.symbol," - ",e.pairs[0].symbol," ",e.tiers[0].tierKey," (Available: ",window.fromDecimals(e.tiers[0].remainingToStake,e.mainToken.decimals),")")))})}))})))}});var CardCraftSelector=React.createClass({displayName:"CardCraftSelector",requiredScripts:["spa/index/cardInfo.jsx"],openSelection:function(t){window.preventItem(t),this.oldValue=this.input.value,this.setState({selecting:!0})},selectCard:function(t,n){var r=this;window.preventItem(t);if(!n&&t.relatedTarget&&$(t.relatedTarget).findReactComponent()===this){var i=parseInt(t.relatedTarget.dataset.index);n=this.props.items.filter(function(e){return e.index===i})[0]}n&&(!n.userData||!n.userData.balanceOf||n.userData.balanceOf==="0");var s={selecting:!1},o=this.state&&this.state.selected;n&&(s.selected=n);var u=this;this.setState(s,function(){u.input.value=!r.oldValue||isNaN(parseInt(r.oldValue))?"4":r.oldValue,delete u.oldValue,o!==n&&u.callOnUpdate()})},onKeyUp:function(t){window.preventItem(t),this.onKeyUpTiemoutId&&window.clearTimeout(this.onKeyUpTiemoutId),this.onKeyUpTiemoutId=window.setTimeout(this.callOnUpdate,window.context.keyUpTimeoutInterval)},callOnUpdate:function(){var t=this;this.highlight();var n=parseInt(this.input&&this.input.value);n=isNaN(n)?0:n;var r=this.state&&this.state.selected,i=this;r&&setTimeout(function(){return i.props.onUpdate(t,{card:r,amount:n})})},highlight:function e(){if(!this.state||!this.state.selected)return $(this.input).removeClass("highlight");var t=parseInt(this.input&&this.input.value);t=isNaN(t)?0:t;var e=window.context.highlightValues.indexOf(t)!==-1;e&&$(this.input).addClass("highlight"),!e&&$(this.input).removeClass("highlight")},renderSelection:function(){var t=this,n=this.props.items,r=this.props.exceptFor||[],i=this.state&&this.state.selected;return r=r.filter(function(e){return e!==undefined&&e!==null&&e.card!==i}).map(function(e){return e.card}),n=n.filter(function(e){return r.indexOf(e)===-1}),React.createElement("section",{className:"cardSelector",tabIndex:"-1",ref:function(t){return t&&t.focus()},onBlur:t.selectCard},React.createElement("ul",null,n.map(function(e){return React.createElement("li",{key:e.key},t.renderCardToClick(e,function(n){return t.selectCard(n,e)},"cardOnSelectionView"))})))},onClick:function(t,n){if(this.props.readOnly)return;n(t)},renderCardToClick:function(t,n,r){var i=this;return React.createElement("a",{href:"javascript:;",className:r+(this.props.readOnly?" disabled":""),"data-index":t.index,onClick:function(t){return i.onClick(t,n)}},React.createElement(CardInfo,{card:t,hideBalance:!0}))},render:function(){var t=this;return this.state&&this.state.selecting?this.renderSelection():React.createElement("section",{className:"craftSingle"},this.state&&this.state.selected&&this.renderCardToClick(this.state.selected,this.openSelection,"cardSelectedView"),(!this.state||!this.state.selected)&&React.createElement("a",{href:"javascript:;",className:"SELECTUM"+(this.props.readOnly?" disabled":""),onClick:this.openSelection},"SELECT"),React.createElement("input",{ref:function(n){return t.input=n},type:"number",className:"cardQuantity",onKeyUp:this.onKeyUp,onChange:this.onKeyUp,readOnly:this.props.readOnly||!this.state||!this.state.selected}))}});var CardInfo=React.createClass({displayName:"CardInfo",requiredScripts:["spa/inlineLoader.jsx"],render:function(){if(!this.props.card.metadata)return React.createElement(InlineLoader,null);var t=!this.props.clean&&(!this.props.card.userData||!this.props.card.userData.balanceOf||this.props.card.userData.balanceOf==="0"),n=!t&&!this.props.hideBalance;return React.createElement("section",{className:"singleCollCard"+(t?" blur":"")},React.createElement("figure",{className:"collCard"},React.createElement("img",{src:this.props.card.staticImage})),n&&React.createElement("span",{className:"cardOwnedNumber Brandized"},this.props.card.userData.balanceOf))}});var IndexController=function(t){var n=this;n.view=t,n.mintEvent="Mint(uint256,address,uint256)",n.loadAddressBarParam=function(){var t=window.addressBarParams.toggle;delete window.addressBarParams.toggle,t&&n.view.setState({toggle:t})},n.loadData=function(){function t(){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function r(){var e,t,i,s,o,u,a,f,l,c;return regeneratorRuntime.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return n.view.setState({collectionName:null,items:null}),h.next=3,window.newContract(window.context.IEthItemABI,window.getNetworkElement("whereIsMyDragonEthItemAddress"));case 3:return window.whereIsMyDragonEthItem=h.sent,h.next=6,window.blockchainCall(window.whereIsMyDragonEthItem.methods.name);case 6:return e=h.sent.toLowerCase().split(" ").join("-"),h.next=9,window.getLogs({address:window.whereIsMyDragonEthItem.options.address,topics:[window.web3.utils.sha3(n.mintEvent)]});case 9:t=h.sent,i=[],s=t,o=Array.isArray(s),u=0,s=o?s:s[Symbol.iterator]();case 12:if(!o){h.next=18;break}if(!(u>=s.length)){h.next=15;break}return h.abrupt("break",28);case 15:a=s[u++],h.next=22;break;case 18:u=s.next();if(!u.done){h.next=21;break}return h.abrupt("break",28);case 21:a=u.value;case 22:f=a,l=window.web3.eth.abi.decodeParameters(["uint256","address","uint256"],f.data),c={index:i.length,key:l[0],objectId:l[0],erc20Wrapper:l[1]},i.push(c);case 26:h.next=12;break;case 28:n.view.setState({collectionName:e,items:i},n.refreshData);case 29:case"end":return h.stop()}},r,this)}));return t}(),n.refreshData=function(){function t(){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function r(){var e=this;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(!n.view||!n.view.mounted||!n.view.state||!n.view.state.items||n.view.state.items.length===0)){r.next=2;break}return r.abrupt("return");case 2:n.view.state.items.forEach(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function r(t){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=t.metadataLink;if(r.t0){r.next=5;break}return r.next=4,window.blockchainCall(window.whereIsMyDragonEthItem.methods.uri,t.objectId);case 4:r.t0=r.sent;case 5:t.metadataLink=r.t0,r.t1=t.metadata;if(r.t1){r.next=11;break}return r.next=10,window.AJAXRequest(window.formatLink(t.metadataLink));case 10:r.t1=r.sent;case 11:return t.metadata=r.t1,t.staticImage="assets/img/cardImages/"+t.objectId+".png",r.next=15,window.blockchainCall(window.whereIsMyDragonEthItem.methods.balanceOf,window.walletAddress,t.objectId);case 15:r.t2=r.sent,t.userData={balanceOf:r.t2},n.view.setState({items:n.view.state.items});case 18:case"end":return r.stop()}},r,e)}));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return r.stop()}},r,this)}));return t}(),n.performCraft=function(){function t(){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function r(){var e,t,i,s,o,u,a,f,l,c;return regeneratorRuntime.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,window.sleep(window.context.keyUpTimeoutInterval+100);case 2:e=n.view.state.selections;if(!(e.filter(function(e){return!e}).length>0)){h.next=5;break}throw"You must select three cards to perform craft";case 5:if(!(e.filter(function(e){return e.amount<=0}).length>0)){h.next=7;break}throw"Each card must contain a positive amount";case 7:t=e,i=Array.isArray(t),s=0,t=i?t:t[Symbol.iterator]();case 8:if(!i){h.next=14;break}if(!(s>=t.length)){h.next=11;break}return h.abrupt("break",23);case 11:o=t[s++],h.next=18;break;case 14:s=t.next();if(!s.done){h.next=17;break}return h.abrupt("break",23);case 17:o=s.value;case 18:u=o;if(!(!u.card.userData||!u.card.userData.balanceOf||parseInt(u.card.userData.balanceOf)<u.amount)){h.next=21;break}throw"You have insufficient "+u.card.metadata.name;case 21:h.next=8;break;case 23:return a=window.walletAddress,f=window.getNetworkElement("whereIsMyDragonCraftAddress"),l=e.map(function(e){return e.card.objectId}),c=e.map(function(e){return e.amount+""}),h.prev=27,h.next=30,window.blockchainCall(window.whereIsMyDragonEthItem.methods.safeBatchTransferFrom,a,f,l,c,"0x");case 30:n.refreshData(),h.next=38;break;case 33:h.prev=33,h.t0=h["catch"](27);if((h.t0.message||h.t0).toLowerCase().indexOf("user denied")===-1){h.next=37;break}return h.abrupt("return");case 37:throw"Something went wrong. Maybe uncorrect crafting?";case 38:case"end":return h.stop()}},r,this,[[27,33]])}));return t}()};var Index=React.createClass({displayName:"Index",getDefaultSubscriptions:function(){return{"ethereum/update":this.controller.loadData,"ethereum/ping":this.controller.refreshData}},requiredScripts:["spa/inlineLoader.jsx","spa/index/cardCraftSelector.jsx","spa/index/cardInfo.jsx"],requiredModules:["spa/farming"],componentDidMount:function(){this.controller.loadAddressBarParam(),this.controller.loadData()},toggleFarming:function(t){t&&t.preventDefault&&t.preventDefault(!0)&&t.stopPropagation&&t.stopPropagation(!0);var n=this.state&&this.state.toggle;this.setState({toggle:n==="farming"?null:"farming"})},perform:function(t){t&&t.preventDefault&&t.preventDefault(!0)&&t.stopPropagation&&t.stopPropagation(!0);var n=t.currentTarget;if(this.state&&this.state.performing||n.className.toLowerCase().indexOf("disabled")!==-1)return;var r=n.dataset.action,i=[];for(var s=1;s<arguments.length;s++)i.push(arguments[s]);var o=this,u=function(t){var n=t&&(t.message||t);o.setState({performing:null},function(){n&&n.indexOf("denied")===-1&&setTimeout(function(){alert(n)}),!n&&o.controller.refreshData()})};o.setState({performing:r},function(){o.controller["perform"+r.firstLetterToUpperCase()].apply(this,i).catch(u).finally(u)})},onCardSelectionUpdate:function(t,n){var r=this.state.selections||[null,null,null];r[t.props.index]=n,this.setState({selections:r})},sortItems:function(){if(this.state.items.filter(function(e){return!e.metadata}).length>0)return this.state.items;var t={};for(var n=this.state.items,r=Array.isArray(n),i=0,n=r?n:n[Symbol.iterator]();;){var s;if(r){if(i>=n.length)break;s=n[i++]}else{i=n.next();if(i.done)break;s=i.value}var o=s,u=o.metadata.attributes.filter(function(e){return e.trait_type==="Rarity"})[0].value;t[u]=t[u]||[],t[u].push(o)}var a=[];for(var f=window.context.rarityOrder,l=Array.isArray(f),c=0,f=l?f:f[Symbol.iterator]();;){var h;if(l){if(c>=f.length)break;h=f[c++]}else{c=f.next();if(c.done)break;h=c.value}var u=h;a.push.apply(a,t[u])}return a},getSelectableItems:function(t){var n=[];for(var r=t,i=Array.isArray(r),s=0,r=i?r:r[Symbol.iterator]();;){var o;if(i){if(s>=r.length)break;o=r[s++]}else{s=r.next();if(s.done)break;o=s.value}var u=o;if(!u.userData||!u.userData.balanceOf||u.userData.balanceOf==="0")continue;n.push(u)}var a=t;return a=a.filter(function(e){return window.context.unselectable.indexOf(e.objectId)===-1}),a},render:function(){var t={};this.props&&Object.entries(this.props).forEach(function(e){return t[e[0]]=e[1]}),this.state&&Object.entries(this.state).forEach(function(e){return t[e[0]]=e[1]}),t.props&&Object.entries(t.props).forEach(function(e){return t[e[0]]=e[1]}),delete t.props;var n=t.items&&this.sortItems(),r=n&&this.getSelectableItems(n);return React.createElement("section",{className:this.state&&this.state.toggle?"ALL2":"ALL"},React.createElement("header",null,React.createElement("a",{target:"_blank",href:"/",className:"brand"},React.createElement("img",{src:"assets/img/logo.png"})),React.createElement("a",{target:"_blank",href:"https://github.com/b-u-i-d-l/Where-Is-My-Dragon",className:"navLink BrandizedS"},"Rules"),React.createElement("a",{className:"navLink BrandizedS"},"ITEM"),React.createElement("a",{className:"navLink BrandizedS",target:"_blank",href:"https://bafybeidohofcst2oxulj75mxdogz77ky7ldhvz27pcqx7htyatuazrcvwi.ipfs.dweb.link/"},"Uniswap"),React.createElement("a",{className:"navLink BrandizedS",target:"_blank",href:window.context.openSeaCollectionLinkTemplate.format(this.state&&this.state.collectionName)},"OpenSea"),window.ethereum&&!window.walletAddress&&React.createElement("a",{className:"connect Brandized",href:"javascript:;",onClick:function(){return window.ethereum.enable()}},"Connect"),t.items&&t.items.length>0&&React.createElement("a",{className:"navLink BrandizedS SPECIALITY",href:"javascript:;",onClick:this.toggleFarming},"Farming"),React.createElement("span",{className:"navThings BrandizedS"},"Treasure: ",window.formatMoney(window.balanceOf,1)," ETH"),window.walletAddress&&React.createElement("a",{className:"connect BrandizedS",target:"_blank",href:window.getNetworkElement("etherscanURL")+"address/"+window.walletAddress},window.shortenWord(window.walletAddress,15))),(!t.items||t.items.length===0)&&React.createElement(InlineLoader,null),t.items&&t.items.length>0&&React.createElement("section",{className:"things"},React.createElement("section",{className:"craft"},React.createElement(CardCraftSelector,{index:0,items:r,exceptFor:t.selections,onUpdate:this.onCardSelectionUpdate,readOnly:t.performing!==undefined&&t.performing!==null}),React.createElement(CardCraftSelector,{index:1,items:r,exceptFor:t.selections,onUpdate:this.onCardSelectionUpdate,readOnly:t.performing!==undefined&&t.performing!==null}),React.createElement(CardCraftSelector,{index:2,items:r,exceptFor:t.selections,onUpdate:this.onCardSelectionUpdate,readOnly:t.performing!==undefined&&t.performing!==null}),React.createElement("section",{className:"action"},t.performing!=="craft"&&React.createElement("a",{className:"actionCraft"+(t.performing||!t.selections||t.selections.filter(function(e){return!e}).length>0?" disabled":""),"data-action":"craft",href:"javascript:;",onClick:this.perform},"Craft"),t.performing==="craft"&&React.createElement(InlineLoader,null))),React.createElement("section",{className:"collectionALL"},n.map(function(e){return React.createElement("section",{key:e.key,className:"collection"},React.createElement(CardInfo,{card:e}),React.createElement("a",{className:"unibtn",href:window.context.uniswapSpawUrlTemplate.format(e.erc20Wrapper),target:"_blank"},"ðŸ¦„swap"))}))),t.items&&t.items.length>0&&t.toggle==="farming"&&React.createElement(Farming,{sortedItems:n}))}});var InlineLoader=React.createClass({displayName:"InlineLoader",render:function(){return React.createElement("section",null,React.createElement("span",null,"Load ðŸ¦–"))}});!window.preloadedScripts && (window.preloadedScripts=[]);Array.prototype.push.apply(window.preloadedScripts,['spa/farming/controller.jsx','spa/farming/style.min.css','spa/farming/view.jsx','spa/index/cardCraftSelector.jsx','spa/index/cardInfo.jsx','spa/index/controller.jsx','spa/index/style.min.css','spa/index/view.jsx','spa/inlineLoader.jsx']);